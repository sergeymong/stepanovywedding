<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1, shrink-to-fit=no">
  <title>Кирилл и Анна</title>
  <meta name="description" content="Приглашение на свадьбу Кирилла и Анны">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      min-height: 100%;
      background: #ffffff;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      -webkit-font-smoothing: antialiased;
    }
    .page {
      max-width: 640px;
      margin: 0 auto;
      background: #ffffff;
    }
    .banner img {
      display: block;
      width: 100%;
      height: auto;
    }
    .banner a {
      display: block;
    }

    /* Carousel */
    .carousel {
      position: relative;
      overflow: hidden;
      touch-action: pan-y;
      user-select: none;
      -webkit-user-select: none;
    }
    .carousel-track {
      display: flex;
      transition: transform 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      will-change: transform;
    }
    .carousel-track.dragging,
    .carousel-track.no-transition {
      transition: none;
    }
    .carousel-slide {
      flex: 0 0 100%;
      min-width: 0;
    }
    .carousel-slide img {
      display: block;
      width: 100%;
      aspect-ratio: 3/4;
      object-fit: cover;
    }
    .carousel-dots {
      display: flex;
      justify-content: center;
      gap: 8px;
      padding: 12px 0;
    }
    .carousel-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ccc;
      border: none;
      padding: 0;
      cursor: pointer;
      transition: background 0.3s, transform 0.3s;
    }
    .carousel-dot.active {
      background: #8b7355;
      transform: scale(1.3);
    }
    .carousel-arrows {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 8px;
    }
    .carousel-arrow {
      pointer-events: auto;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: #333;
      transition: opacity 0.3s;
      opacity: 0.6;
    }
    .carousel-arrow:hover { opacity: 1; }
    .carousel-arrow:active { transform: scale(0.9); }
  </style>
</head>
<body>
  <div class="page">
    <div class="banner">
      <img src="images/01_main.webp" alt="Кирилл и Анна — приглашение на свадьбу">
    </div>
    <div class="banner">
      <a href="https://yandex.ru/maps/-/CPAHjX-Q" target="_blank" rel="noopener">
        <img src="images/02_map.png" alt="Схема проезда">
      </a>
    </div>
    <div class="banner">
      <img src="images/03_banner.png" alt="">
    </div>

    <!-- Карусель -->
    <div class="carousel" id="gallery">
      <div class="carousel-track" id="galleryTrack">
        <div class="carousel-slide"><img src="images/04_photo1.jpg" alt="Фото 1"></div>
        <div class="carousel-slide"><img src="images/04_photo2.jpg" alt="Фото 2"></div>
        <div class="carousel-slide"><img src="images/04_photo3.webp" alt="Фото 3"></div>
      </div>
      <div class="carousel-arrows">
        <button class="carousel-arrow" id="prevBtn">&#8249;</button>
        <button class="carousel-arrow" id="nextBtn">&#8250;</button>
      </div>
    </div>
    <div class="carousel-dots" id="galleryDots"></div>

    <div class="banner">
      <img src="images/05_banner2.png" alt="">
    </div>
    <div class="banner">
      <a href="https://forms.gle/bo2c8CuB1iomwazUA" target="_blank" rel="noopener">
        <img src="images/06_rsvp.png" alt="Подтвердить присутствие">
      </a>
    </div>
    <div class="banner">
      <img src="images/07_bottom.png" alt="">
    </div>
  </div>

  <script>
    (function() {
      const track = document.getElementById('galleryTrack');
      const dots = document.getElementById('galleryDots');
      const total = 3; // original slide count
      let pos = 1;     // starts at 1 because of prepended clone
      let startX = 0, moveX = 0, isDragging = false, isTransitioning = false;

      // Clone first and last slides for infinite loop
      const origSlides = Array.from(track.children);
      const firstClone = origSlides[0].cloneNode(true);
      const lastClone = origSlides[origSlides.length - 1].cloneNode(true);
      firstClone.setAttribute('aria-hidden', 'true');
      lastClone.setAttribute('aria-hidden', 'true');
      track.appendChild(firstClone);
      track.insertBefore(lastClone, track.firstChild);
      // Now track has: [clone-last] [orig-1] [orig-2] [orig-3] [clone-first]
      // Indices:          0           1        2        3          4

      // Set initial position (no animation)
      track.classList.add('no-transition');
      track.style.transform = 'translateX(-100%)';
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          track.classList.remove('no-transition');
        });
      });

      // Create dots
      for (let i = 0; i < total; i++) {
        const dot = document.createElement('button');
        dot.className = 'carousel-dot' + (i === 0 ? ' active' : '');
        dot.setAttribute('aria-label', 'Фото ' + (i + 1));
        dot.addEventListener('click', () => slideTo(i + 1));
        dots.appendChild(dot);
      }

      function updateDots() {
        let real = pos - 1; // convert track pos to 0-based real index
        if (real < 0) real = total - 1;
        if (real >= total) real = 0;
        dots.querySelectorAll('.carousel-dot').forEach((d, i) =>
          d.classList.toggle('active', i === real)
        );
      }

      function slideTo(index) {
        if (isTransitioning) return;
        isTransitioning = true;
        pos = index;
        track.style.transform = 'translateX(' + (-pos * 100) + '%)';
        updateDots();
      }

      // After transition: silently jump if on a clone
      track.addEventListener('transitionend', () => {
        isTransitioning = false;
        if (pos === 0) {
          // On clone-last → jump to real last
          track.classList.add('no-transition');
          pos = total;
          track.style.transform = 'translateX(' + (-pos * 100) + '%)';
          requestAnimationFrame(() => {
            requestAnimationFrame(() => {
              track.classList.remove('no-transition');
            });
          });
        } else if (pos === total + 1) {
          // On clone-first → jump to real first
          track.classList.add('no-transition');
          pos = 1;
          track.style.transform = 'translateX(' + (-pos * 100) + '%)';
          requestAnimationFrame(() => {
            requestAnimationFrame(() => {
              track.classList.remove('no-transition');
            });
          });
        }
      });

      // Arrows
      document.getElementById('prevBtn').addEventListener('click', () => slideTo(pos - 1));
      document.getElementById('nextBtn').addEventListener('click', () => slideTo(pos + 1));

      // Touch swipe
      track.addEventListener('touchstart', (e) => {
        if (isTransitioning) return;
        startX = e.touches[0].clientX;
        moveX = 0;
        isDragging = true;
        track.classList.add('dragging');
      }, { passive: true });

      track.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        moveX = e.touches[0].clientX - startX;
        const offset = -pos * 100 + (moveX / track.offsetWidth) * 100;
        track.style.transform = 'translateX(' + offset + '%)';
      }, { passive: true });

      track.addEventListener('touchend', () => {
        if (!isDragging) return;
        isDragging = false;
        track.classList.remove('dragging');
        const threshold = track.offsetWidth * 0.2;
        if (moveX < -threshold) slideTo(pos + 1);
        else if (moveX > threshold) slideTo(pos - 1);
        else slideTo(pos);
        moveX = 0;
      });

      // Mouse drag (desktop)
      track.addEventListener('mousedown', (e) => {
        if (isTransitioning) return;
        startX = e.clientX;
        moveX = 0;
        isDragging = true;
        track.classList.add('dragging');
        e.preventDefault();
      });
      document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        moveX = e.clientX - startX;
        const offset = -pos * 100 + (moveX / track.offsetWidth) * 100;
        track.style.transform = 'translateX(' + offset + '%)';
      });
      document.addEventListener('mouseup', () => {
        if (!isDragging) return;
        isDragging = false;
        track.classList.remove('dragging');
        const threshold = track.offsetWidth * 0.2;
        if (moveX < -threshold) slideTo(pos + 1);
        else if (moveX > threshold) slideTo(pos - 1);
        else slideTo(pos);
        moveX = 0;
      });

      // Prevent image drag
      track.querySelectorAll('img').forEach(img => {
        img.addEventListener('dragstart', e => e.preventDefault());
      });
    })();
  </script>
</body>
</html>